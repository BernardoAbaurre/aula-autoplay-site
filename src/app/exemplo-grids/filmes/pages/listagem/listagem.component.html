<div class="container mt-4">
  <h1 class="mb-4">Listagem de Filmes</h1>

  <!-- Accordion de Filtros -->
  <div class="accordion mb-4" id="accordionFiltros">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingFiltros">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapseFiltros"
          aria-expanded="false"
          aria-controls="collapseFiltros">
          <i class="bi bi-funnel me-2"></i>
          Filtros de Pesquisa
        </button>
      </h2>
      <div
        id="collapseFiltros"
        class="accordion-collapse collapse"
        aria-labelledby="headingFiltros"
        data-bs-parent="#accordionFiltros">
        <div class="accordion-body">
          <form [formGroup]="filtroForm" (ngSubmit)="filtrar()">
            <div class="row g-3">
              <!-- ID -->
              <div class="col-md-2">
                <label for="id" class="form-label">ID</label>
                <input
                  type="number"
                  class="form-control"
                  id="id"
                  formControlName="Id"
                  placeholder="ID">
              </div>

              <!-- Nome -->
              <div class="col-md-5">
                <label for="nome" class="form-label">Nome</label>
                <input
                  type="text"
                  class="form-control"
                  id="nome"
                  formControlName="Nome"
                  placeholder="Nome do filme">
              </div>

              <!-- Direção -->
              <div class="col-md-5">
                <label for="direcao" class="form-label">Direção</label>
                <input
                  type="text"
                  class="form-control"
                  id="direcao"
                  formControlName="Direcao"
                  placeholder="Nome do diretor">
              </div>

              <!-- Nota Mínima -->
              <div class="col-md-3">
                <label for="notaMinima" class="form-label">Nota Mínima</label>
                <input
                  type="number"
                  step="0.1"
                  class="form-control"
                  id="notaMinima"
                  formControlName="NotaMinima"
                  placeholder="Ex: 7.0">
              </div>

              <!-- Nota Máxima -->
              <div class="col-md-3">
                <label for="notaMaxima" class="form-label">Nota Máxima</label>
                <input
                  type="number"
                  step="0.1"
                  class="form-control"
                  id="notaMaxima"
                  formControlName="NotaMaxima"
                  placeholder="Ex: 10.0">
              </div>

              <!-- Duração Mínima -->
              <div class="col-md-3">
                <label for="duracaoMinima" class="form-label">Duração Mínima (min)</label>
                <input
                  type="number"
                  class="form-control"
                  id="duracaoMinima"
                  formControlName="DuracaoMinima"
                  placeholder="Ex: 90">
              </div>

              <!-- Duração Máxima -->
              <div class="col-md-3">
                <label for="duracaoMaxima" class="form-label">Duração Máxima (min)</label>
                <input
                  type="number"
                  class="form-control"
                  id="duracaoMaxima"
                  formControlName="DuracaoMaxima"
                  placeholder="Ex: 180">
              </div>
            </div>

            <!-- Botões -->
            <div class="row mt-3">
              <div class="col-12">
                <button type="submit" class="btn btn-primary me-2">
                  <i class="bi bi-search"></i> Filtrar
                </button>
                <button type="button" class="btn btn-secondary" (click)="limparFiltros()">
                  <i class="bi bi-x-circle"></i> Limpar Filtros
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="carregando" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <!-- Erro -->
  <div *ngIf="erro" class="alert alert-danger" role="alert">
    {{ erro }}
  </div>

  <!-- Tabela de Filmes -->
  <div *ngIf="!carregando && !erro" class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th scope="col" class="cursor-pointer" (click)="ordenar('Id')">
            ID <i class="bi" [ngClass]="getIconeOrdenacao('Id')"></i>
          </th>
          <th scope="col" class="cursor-pointer" (click)="ordenar('Nome')">
            Nome <i class="bi" [ngClass]="getIconeOrdenacao('Nome')"></i>
          </th>
          <th scope="col" class="cursor-pointer" (click)="ordenar('Direcao')">
            Direção <i class="bi" [ngClass]="getIconeOrdenacao('Direcao')"></i>
          </th>
          <th scope="col" class="cursor-pointer" (click)="ordenar('Duracao')">
            Duração (min) <i class="bi" [ngClass]="getIconeOrdenacao('Duracao')"></i>
          </th>
          <th scope="col" class="cursor-pointer" (click)="ordenar('Nota')">
            Nota <i class="bi" [ngClass]="getIconeOrdenacao('Nota')"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let filme of filmes">
          <th scope="row">{{ filme.Id }}</th>
          <td>{{ filme.Nome }}</td>
          <td>{{ filme.Direcao }}</td>
          <td>{{ filme.Duracao }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'bg-success': filme.Nota >= 8,
              'bg-primary': filme.Nota >= 6 && filme.Nota < 8,
              'bg-warning': filme.Nota >= 4 && filme.Nota < 6,
              'bg-danger': filme.Nota < 4
            }">
              {{ filme.Nota | number:'1.1-1' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Mensagem quando não há resultados -->
    <div *ngIf="filmes.length === 0" class="alert alert-info text-center">
      Nenhum filme encontrado.
    </div>
  </div>
</div>
